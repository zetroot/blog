---
layout: post
title:  "Непростое простое сравнение"
date:   2023-05-02 12:30 +0300
categories: 
---

Как можно дурить голову себе и QA на ровном месте? Тестировать не тот код, который выполняется приложением!

Это очень простая мораль, из гораздо более сложной истории, в которой случались моя самоуверенность, черезмерная вера в тесты, недостаточное понимание того, как работают методы BCL. Пришлось с этим разобраться. 

# Завязка
Здесь я не буду вдаваться в предметную область происходяещего, потому что кажется она не очень важна, для обсуждаемой проблемы, а так же чтобы не навлечь на себя внимание комплайенса своего работодателя, конечно же.
Положим, что у нас есть некоторый сервис, задача которого отслеживать некоторые снимки текущего состояния объекта и выявлять между ними разницу. В частности один из интересующих нас параметров состояния представляет из себя коллекцию объектов, действий соверщенных объектом. При этом исходя из знаний предметной области можно узнать, что всё может быть не очень просто при сравнении записей о действиях. У каждой записи есть 3 ключевых атрибута:
 - Идентификатор источника, который это действие зарепортил. Он может быть, а может и не быть. При этом каждое действие может быть зарепорчено только одним источником. Но может оказаться и так, что у этого действия нет источника.  
 - Строковый уникальный ключ. Это почти что серебряная пуля, если только не было бы обратной совместимости...
 - Устаревший строковый ключ, по которому можно сравнивать действия, только если какое то из действий не имеет записи о строковом уникальном ключе.

